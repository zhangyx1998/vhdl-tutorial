import{_ as s,c as n,o as a,a as l}from"./app.cdbf6830.js";const F=JSON.parse('{"title":"Counter","description":"","frontmatter":{},"headers":[{"level":2,"title":"Brief","slug":"brief","link":"#brief","children":[]},{"level":2,"title":"ENTITY  counter4bit","slug":"entity-counter4bit","link":"#entity-counter4bit","children":[]},{"level":2,"title":"ARCH  BHV_INT_BAD1 of counter4bit","slug":"arch-bhv-int-bad1-of-counter4bit","link":"#arch-bhv-int-bad1-of-counter4bit","children":[]},{"level":2,"title":"ARCH  BHV_INT_BAD2 of counter4bit","slug":"arch-bhv-int-bad2-of-counter4bit","link":"#arch-bhv-int-bad2-of-counter4bit","children":[]},{"level":2,"title":"ARCH  BHV_INT_GOOD of counter4bit","slug":"arch-bhv-int-good-of-counter4bit","link":"#arch-bhv-int-good-of-counter4bit","children":[]},{"level":2,"title":"ARCH  BHV_UNSIGNED of counter4bit","slug":"arch-bhv-unsigned-of-counter4bit","link":"#arch-bhv-unsigned-of-counter4bit","children":[]},{"level":2,"title":"ENTITY  counter_max","slug":"entity-counter-max","link":"#entity-counter-max","children":[]},{"level":2,"title":"ARCH  BHV_INT of counter_max","slug":"arch-bhv-int-of-counter-max","link":"#arch-bhv-int-of-counter-max","children":[]},{"level":2,"title":"ARCH  BHV_UNSIGNED of counter_max","slug":"arch-bhv-unsigned-of-counter-max","link":"#arch-bhv-unsigned-of-counter-max","children":[]},{"level":2,"title":"ENTITY  counter_max2","slug":"entity-counter-max2","link":"#entity-counter-max2","children":[]},{"level":2,"title":"ARCH  BHV_INT of counter_max2","slug":"arch-bhv-int-of-counter-max2","link":"#arch-bhv-int-of-counter-max2","children":[]},{"level":2,"title":"ARCH  BHV_UNSIGNED of counter_max2","slug":"arch-bhv-unsigned-of-counter-max2","link":"#arch-bhv-unsigned-of-counter-max2","children":[]},{"level":2,"title":"ENTITY  counter","slug":"entity-counter","link":"#entity-counter","children":[]},{"level":2,"title":"ARCH  default_arch of counter","slug":"arch-default-arch-of-counter","link":"#arch-default-arch-of-counter","children":[]},{"level":2,"title":"PKG  counter_pkg","slug":"pkg-counter-pkg","link":"#pkg-counter-pkg","children":[]},{"level":2,"title":"PKG  body counter_pkg","slug":"pkg-body-counter-pkg","link":"#pkg-body-counter-pkg","children":[]},{"level":2,"title":"ENTITY  counter_tb","slug":"entity-counter-tb","link":"#entity-counter-tb","children":[]},{"level":2,"title":"ARCH  TB of counter_tb","slug":"arch-tb-of-counter-tb","link":"#arch-tb-of-counter-tb","children":[]}],"relativePath":"sequential/counter/index.md"}'),o={name:"sequential/counter/index.md"},p=l(`<h1 id="counter" tabindex="-1">Counter <a class="header-anchor" href="#counter" aria-hidden="true">#</a></h1><details class="details custom-block"><summary>Get source code for this page</summary><div style="display:flex;flex-direction:row;"><a href="data:text/plain;charset=utf-8,--%20Greg%20Stitt%0A--%20University%20of%20Florida%0A%0A--%20The%20examples%20shows%20a%20variety%20of%20ways%20of%20creating%20counters%2C%20while%20also%0A--%20illustrating%20the%20differences%20between%20integer%20and%20vector%20types.%20The%20examples%0A--%20also%20show%20how%20to%20define%20custom%20functions%20and%20use%20attributes%20to%20simplify%0A--%20the%20code.%0A%0A--%20TAKEAWAY%20POINTS%3A%0A--%20My%20recommendation%20is%20to%20only%20use%20integer%20types%20for%20constants%20or%20literals.%0A--%20If%20you%20do%20use%20them%20for%20signals%2Fvariables%2C%20then%20the%20range%20should%20be%0A--%20constrained.%20Even%20then%2C%20constrained%20integers%20frequently%20cause%20simulation%0A--%20errors.%20%0A%0A%0A--%20The%20following%20counter%20entity%20shows%20another%20basic%20sequential%20logic%20example%2C%0A--%20but%20compares%20the%20usage%20of%20the%20integer%20type%20and%20unsigned%20type.%20For%20this%0A--%20particular%20example%2C%20unsigned%20is%20clearly%20the%20better%20choice.%0A%0Alibrary%20ieee%3B%0Ause%20ieee.std_logic_1164.all%3B%0Ause%20ieee.numeric_std.all%3B%0A%0Aentity%20counter4bit%20is%0A%20%20%20%20port%20(%0A%20%20%20%20%20%20%20%20clk%20%20%20%20%3A%20in%20%20std_logic%3B%0A%20%20%20%20%20%20%20%20rst%20%20%20%20%3A%20in%20%20std_logic%3B%0A%20%20%20%20%20%20%20%20up%20%20%20%20%20%3A%20in%20%20std_logic%3B%0A%20%20%20%20%20%20%20%20output%20%3A%20out%20std_logic_vector(3%20downto%200))%3B%0Aend%20counter4bit%3B%0A%0A--%20The%20first%20architecture%20illustrates%20a%20common%20problem%20with%20the%20integer%20type.%0A%0Aarchitecture%20BHV_INT_BAD1%20of%20counter4bit%20is%0A%20%20%20%20--%20Use%20an%20internal%20signal%20to%20maintain%20the%20count.%20The%20counter%20is%204%20bits%20so%0A%20%20%20%20--%20we%20want%20the%20range%20to%20be%20from%200%20to%2015.%0A%20%20%20%20--%0A%20%20%20%20--%20IMPORTANT%3A%20When%20using%20an%20integer%20type%2C%20you%20should%20always%20constrain%20the%0A%20%20%20%20--%20range%20of%20possible%20values.%20If%20you%20don&#39;t%2C%20it%20will%20synthesize%20to%2032%20bits%2C%0A%20%20%20%20--%20which%20is%20likely%20a%20signficant%20waste%20of%20space.%20In%20some%20cases%2C%20synthesis%0A%20%20%20%20--%20will%20be%20able%20to%20optimize%20away%20the%20extra%20bits%2C%20but%20it%20is%20better%20to%0A%20%20%20%20--%20always%20explicitly%20constrain%20it.%0A%20%20%20%20signal%20count_r%20%3A%20integer%20range%200%20to%2015%3B%0A%20%20%20%20%0Abegin%0A%20%20%20%20--%20A%20counter%20involves%20sequential%20logic%2C%20so%20follow%20the%20guidelines%20for%0A%20%20%20%20--%20sequential%20logic.%0A%20%20%20%20process(clk%2C%20rst)%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20if%20(rst%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20Initialize%20the%20count.%20Integer%20literals%20do%20not%20use%20quotes.%0A%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20elsif%20(rising_edge(clk))%20then%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20Implement%20the%20basic%20counter%20functionality.%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20Although%20this%20looks%20like%20it%20should%20work%2C%20if%20you%20simulate%20this%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20code%2C%20you%20will%20receive%20an%20error%20similar%20to%20the%20following%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20Fatal%3A%20(vsim-3421)%20Value%2016%20for%20count%20is%20out%20of%20range%200%20to%2015.%0A%20%20%20%20%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20The%20problem%20occurs%20because%20the%20integer%20type%20will%20not%20rollover%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20from%20its%20maximum%20value%20(15)%20to%20its%20minimum%20value%20(0)%20when%20there%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20is%20overflow.%20Instead%2C%20when%20the%20simulation%20adds%201%20to%20count%20when%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20count%20%3D%2015%2C%20count%20will%20become%2016.%20However%2C%20we%20defined%20count%20as%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20only%20having%20values%20from%200%20to%2015%2C%20so%2016%20is%20invalid%2C%20which%20causes%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20the%20simulation%20error.%20The%20same%20problem%20would%20occur%20when%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20subtracting%201%20when%20count%20%3D%200.%0A%20%20%20%20%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20This%20problem%20demonstrates%20one%20of%20the%20main%20annoyances%20of%20the%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20integer%20type.%20You%20have%20to%20be%20100%25%20sure%20that%20the%20signal%20will%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20never%20have%20a%20value%20outside%20of%20the%20specified%20range.%0A%20%20%20%20%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20I%20almost%20never%20use%20integers%20for%20this%20reason.%20What%20makes%20this%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20especially%20problematic%20is%20that%20this%20code%20will%20likely%20synthesize%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20with%20the%20correct%20functionality%2C%20but%20you%20can&#39;t%20simulate%20it%2C%20so%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20it%20isn&#39;t%20very%20useful.%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(up%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20%2B%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20-%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20end%20process%3B%0A%0A%20%20%20%20--%20Send%20the%20count%20to%20the%20output.%20Notice%20that%20this%20is%20done%20outside%20of%20the%0A%20%20%20%20--%20process%2C%20otherwise%20there%20would%20be%20an%20additional%20register%20for%20output%2C%0A%20%20%20%20--%20which%20we%20don&#39;t%20want.%20To%20convert%20from%20integer%20to%20std_logic_vector%2C%20you%0A%20%20%20%20--%20can%20first%20convert%20to%20unsigned%20using%20the%20to_unsigned%20function%2C%20assuming%0A%20%20%20%20--%20you%20are%20using%20numeric_std.%0A%0A%20%20%20%20output%20%3C%3D%20std_logic_vector(to_unsigned(count_r%2C%204))%3B%0A%20%20%20%20%0Aend%20BHV_INT_BAD1%3B%0A%0A%0A--%20The%20following%20architecture%20demonstrates%20another%20common%20mistake%20when%20using%20integers.%0A%0Aarchitecture%20BHV_INT_BAD2%20of%20counter4bit%20is%0A%0A%20%20%20%20signal%20count_r%20%3A%20integer%20range%200%20to%2015%3B%0A%20%20%20%20%0Abegin%0A%20%20%20%20process(clk%2C%20rst)%0A%20%20%20%20%20%20%20%20--%20To%20avoid%20the%20problem%20with%20the%20previous%20architecture%2C%20we%20are%20going%20to%0A%20%20%20%20%20%20%20%20--%20add%20values%20using%20a%20variable%2C%20check%20the%20variable%20for%20overflow%2C%20and%0A%20%20%20%20%20%20%20%20--%20then%20update%20the%20count.%0A%20%20%20%20%20%20%20%20variable%20temp%20%3A%20integer%20range%200%20to%2015%3B%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20if%20(rst%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%200%3B%0A%20%20%20%20%20%20%20%20elsif%20(rising_edge(clk))%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(up%20%3D%20&#39;1&#39;)%20then%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20Get%20the%20new%20count%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20temp%20%3A%3D%20count_r%20%2B%201%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20Check%20to%20see%20if%20we%20exceeded%20the%20maximum%20value%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(temp%20%3D%2016)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20temp%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20Get%20the%20new%20count%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20temp%20%3A%3D%20count_r%20-%201%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20Check%20to%20see%20if%20we%20exceeded%20the%20minimum%20value%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(temp%20%3D%20-1)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%2015%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20temp%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20When%20simulting%20this%20code%2C%20we%20get%20a%20similar%20error%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20Fatal%3A%20(vsim-3421)%20Value%2016%20for%20temp%20is%20out%20of%20range%200%20to%2015.%0A%20%20%20%20%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20This%20error%20occurs%20for%20a%20similar%20reason%20as%20before.%20When%20we%20add%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20one%20to%20count%20when%20count%20%3D%2015%2C%20temp%20needs%20to%20be%20able%20to%20store%2016.%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20Likewise%2C%20when%20we%20subtract%20one%20from%20count%20when%20it%20is%200%2C%20temp%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20needs%20to%20store%20-1.%20However%2C%20we%20declared%20temp%20as%20having%20a%20range%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20from%200%20to%2015.%0A%20%20%20%20%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20We%20could%20potentially%20fix%20the%20problem%20by%20changing%20the%20range%20of%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20temp%20from%20-1%20to%2016%2C%20but%20the%20following%20architectures%20shows%20a%20more%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20concise%20solution.%0A%20%20%20%20%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20The%20key%20point%20to%20remember%20is%20that%20when%20using%20an%20integer%2C%20you%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20have%20to%20be%20sure%20that%20the%20signal%2Fvariable%20will%20never%20exceed%20that%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20range.%20Although%20it%20might%20be%20obvious%20for%20this%20simple%20counter%2C%20for%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20complex%20examples%20using%20integers%2C%20it%20can%20be%20very%20difficult.%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20end%20process%3B%0A%0A%20%20%20%20output%20%3C%3D%20std_logic_vector(to_unsigned(count_r%2C%204))%3B%0A%20%20%20%20%0Aend%20BHV_INT_BAD2%3B%0A%0A%0A--%20The%20following%20architecture%20show%20a%20correct%20implementation%20of%20the%20counter%20when%0A--%20using%20integers%0A%0Aarchitecture%20BHV_INT_GOOD%20of%20counter4bit%20is%0A%20%20%20%20signal%20count_r%20%3A%20integer%20range%200%20to%2015%3B%0A%20%20%20%20%0Abegin%0A%20%20%20%20process(clk%2C%20rst)%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20if%20(rst%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%200%3B%0A%20%20%20%20%20%20%20%20elsif%20(rising_edge(clk))%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(up%20%3D%20&#39;1&#39;)%20then%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20Instead%20of%20using%20a%20variable%20to%20check%20for%20overflow%2C%20we%20can%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20simply%20check%20to%20see%20if%20count%20is%20already%20at%20the%20max%20value.%20If%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20so%2C%20set%20it%20to%200%20instead%20of%20adding%201.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%2015)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20%2B%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20Similarly%2C%20if%20we%20are%20counting%20down%20and%20count%20%3D%200%2C%20set%20the%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20count%20to%2015%20insted%20of%20subtracting%201.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%200)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%2015%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20-%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20end%20process%3B%0A%0A%20%20%20%20output%20%3C%3D%20std_logic_vector(to_unsigned(count_r%2C%204))%3B%0A%20%20%20%20%0Aend%20BHV_INT_GOOD%3B%0A%0A%0A--%20Although%20the%20previous%20architecture%20works%2C%20we%20had%20to%20use%20additional%20code%20to%0A--%20make%20sure%20that%20count%20values%20wrapped%20around%20appropriately.%20If%20we%20use%20unsigned%2C%0A--%20signed%2C%20or%20std_logic_vector%2C%20the%20wrapping%20around%20is%20handled%20automatically%20by%0A--%20the%20type.%20%0A%0Aarchitecture%20BHV_UNSIGNED%20of%20counter4bit%20is%0A%20%20%20%20--%20Use%20a%204%20bit%20unsigned%20instead%20of%20an%20integer.%0A%20%20%20%20signal%20count_r%20%3A%20unsigned(3%20downto%200)%3B%0A%20%20%20%20%0Abegin%0A%20%20%20%20process(clk%2C%20rst)%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20if%20(rst%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20%220000%22%3B%0A%20%20%20%20%20%20%20%20elsif%20(rising_edge(clk))%20then%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20Here%20that%20we%20can%20just%20add%20or%20subtract%201%20without%20any%20range%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20check%20because%20wrapping%20will%20automatically%20occur.%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(up%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20Notice%20that%20we%20can%20actually%20add%20an%20unsigned%2Fsigned%20with%20an%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20integer%20because%20numeric_std%20also%20defines%20most%20operators%20for%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20integer%20types.%20Fortunately%2C%20you%20do%20not%20have%20to%20worry%20about%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20about%20the%2032-bit%20integer%20increasing%20the%20size%20of%20the%20circuit.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20When%20adding%20an%20unsigned%2Fsigned%20with%20an%20integer%2C%20the%20integer%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20is%20automatically%20truncated%20to%20the%20width%20of%20the%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20--%20unsigned%2Fsigned.%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20%2B%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20-%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20end%20process%3B%0A%0A%20%20%20%20output%20%3C%3D%20std_logic_vector(count_r)%3B%0A%20%20%20%20%0Aend%20BHV_UNSIGNED%3B%0A%0A%0A---------------------------------------------------------------------%0A%0A%0A--%20The%20following%20counter%20extends%20the%20previous%20counter4bit%20entity%20with%20a%20generic%0A--%20that%20specifies%20the%20maximum%20counter%20value.%20The%20minimum%20value%20is%20assumed%20to%20be%0A--%200.%20As%20an%20exercise%2C%20I%20would%20recommend%20adding%20a%20MIN_VALUE%20that%20supports%0A--%20negative%20numbers%20and%20changing%20the%20counter%20to%20signed.%0A%0Alibrary%20ieee%3B%0Ause%20ieee.std_logic_1164.all%3B%0Ause%20ieee.numeric_std.all%3B%0Ause%20ieee.math_real.all%3B%0A%0Aentity%20counter_max%20is%0A%20%20%20%20generic(MAX_VALUE%20%3A%20positive%20%3A%3D%2015)%3B%0A%20%20%20%20port%20(%0A%20%20%20%20%20%20%20%20clk%20%3A%20in%20std_logic%3B%0A%20%20%20%20%20%20%20%20rst%20%3A%20in%20std_logic%3B%0A%20%20%20%20%20%20%20%20up%20%20%3A%20in%20std_logic%3B%0A%0A%20%20%20%20%20%20%20%20--%20For%20this%20entity%2C%20the%20output%20is%20not%20a%20fixed%20number%20of%20bits.%20%0A%20%20%20%20%20%20%20%20--%20The%20output%20has%20MAX_VALUE%2B1%20possible%20values%2C%20so%20we%20need%20to%20do%20some%0A%20%20%20%20%20%20%20%20--%20math%20to%20calculate%20the%20number%20of%20bits.%20If%20MAX_VALUE%2B1%20was%20a%20power%0A%20%20%20%20%20%20%20%20--%20of%202%2C%20we%20could%20just%20do%20log2(MAX_VALUE%2B1).%0A%20%20%20%20%20%20%20%20--%20%0A%20%20%20%20%20%20%20%20--%20However%2C%20MAX_VALUE%20is%20a%20generic%20and%20can%20be%20any%20possible%20value.%0A%20%20%20%20%20%20%20%20--%20We%20therefore%20want%20to%20take%20the%20ceiling%20of%20the%20log2%20to%20ensure%20we%0A%20%20%20%20%20%20%20%20--%20have%20enough%20bits.%0A%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20--%20e.g.%2C%20if%20the%20maximum%20value%20is%2010%2C%20the%20output%20can%20have%2011%20possible%0A%20%20%20%20%20%20%20%20--%20values.%20log2(11)%20%3D%203.4%2C%20which%20will%20round%20down%20to%203%20when%20used%20as%20an%0A%20%20%20%20%20%20%20%20--%20integer.%20However%2C%20we%20know%20we%20need%204%20bits%20since%203%20bits%20only%20supports%0A%20%20%20%20%20%20%20%20--%208%20values%2C%20with%20a%20maximum%20value%20of%207.%20By%20taking%20the%20ceiling%2C%0A%20%20%20%20%20%20%20%20--%20ceil(3.4)%20%3D%204%2C%20we%20get%20the%20correct%20number%20of%20bits.%0A%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20--%20To%20do%20this%20calculation%20in%20VHDL%2C%20we%20can%20use%20the%20log2%20and%20ceil%20function%0A%20%20%20%20%20%20%20%20--%20from%20the%20math_real%20package.%20However%2C%20log2%20and%20ceil%20only%20support%20the%0A%20%20%20%20%20%20%20%20--%20real%20type%2C%20so%20we%20have%20to%20cast%20the%20input%20to%20real.%20Similarly%2C%20we%20need%0A%20%20%20%20%20%20%20%20--%20to%20cast%20the%20ceil%20result%20back%20to%20an%20integer.%20The%20complete%2C%20horribly%0A%20%20%20%20%20%20%20%20--%20ugly%20computation%20is%3A%20integer(ceil(log2(real(MAX_VALUE%2B1)))).%20I%20will%0A%20%20%20%20%20%20%20%20--%20show%20a%20more%20readable%20way%20of%20doing%20this%20in%20the%20next%20entity.%0A%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20--%20Be%20aware%20that%20calculating%20the%20appropriate%20number%20of%20bits%20is%20a%0A%20%20%20%20%20%20%20%20--%20common%20place%20for%20errors.%20You%20should%20test%20this%20for%20a%20large%20number%0A%20%20%20%20%20%20%20%20--%20of%20generics%20to%20be%20confident%20that%20it%20is%20correct.%20A%20very%20common%0A%20%20%20%20%20%20%20%20--%20mistake%20is%20forgetting%20the%20%2B1.%20Remember%20that%20log2%20of%20a%20number%20doesn&#39;t%0A%20%20%20%20%20%20%20%20--%20tell%20you%20the%20number%20of%20bits%20needed%20to%20represent%20that%20number%2C%20unless%0A%20%20%20%20%20%20%20%20--%20it%20is%20a%20power%20of%202.%20Log2(n)%20specifies%20how%20many%20bits%20are%20required%20to%0A%20%20%20%20%20%20%20%20--%20represent%20n%20different%20values.%20Since%20we%20also%20have%20to%20support%200%2C%20there%0A%20%20%20%20%20%20%20%20--%20are%20n%2B1%20total%20values.%0A%20%20%20%20%20%20%20%20output%20%3A%20out%20std_logic_vector(integer(ceil(log2(real(MAX_VALUE%2B1))))-1%20downto%200))%3B%0Aend%20counter_max%3B%0A%0A%0A--%20In%20this%20architecture%2C%20we%20modify%20the%20integer%20implementation%20from%20the%0A--%20counter4bit%20entity%20by%20replacing%20the%20hardcoded%2015%20with%20MAX_VALUE.%0A%0Aarchitecture%20BHV_INT%20of%20counter_max%20is%0A%0A%20%20%20%20signal%20count_r%20%3A%20integer%20range%200%20to%20MAX_VALUE%3B%0A%0A%20%20%20%20--%20We%20need%20the%20number%20of%20bits%20later%2C%20so%20create%20a%20constant.%0A%20%20%20%20--%20If%20you%20are%20wondering%20if%20we%20could%20use%20a%20constant%20when%20defining%0A%20%20%20%20--%20the%20width%20of%20output%20in%20the%20port%20statement%2C%20the%20answer%20is%20sometimes.%0A%20%20%20%20--%20You%20can%20define%20constants%20in%20a%20custom%20package%20and%20then%20use%20those%0A%20%20%20%20--%20constants%20in%20port%20definitions.%20However%2C%20VHDL%20pre-2008%20doesn&#39;t%20allow%20you%0A%20%20%20%20--%20to%20define%20constants%20in%20packages%20based%20on%20generic%20values.%20So%2C%20for%20this%0A%20%20%20%20--%20entity%2C%20we%20are%20stuck%20with%20using%20the%20bit%20calculation%20in%20the%20port%0A%20%20%20%20--%20definition.%20We%20could%20also%20create%20a%20function%20that%20returns%20the%20number%20of%0A%20%20%20%20--%20bits%2C%20which%20could%20be%20used%20everywhere%2C%20but%20that%20will%20be%20shown%20in%20a%20later%0A%20%20%20%20--%20example.%0A%20%20%20%20constant%20NUM_BITS%20%3A%20positive%20%3A%3D%20integer(ceil(log2(real(MAX_VALUE%2B1))))%3B%0A%20%20%20%20%0Abegin%0A%20%20%20%20%0A%20%20%20%20process(clk%2C%20rst)%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20if%20(rst%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%200%3B%0A%20%20%20%20%20%20%20%20elsif%20(rising_edge(clk))%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(up%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%20MAX_VALUE)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20%2B%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%200)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20MAX_VALUE%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20-%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20end%20process%3B%0A%0A%20%20%20%20--%20We%20can&#39;t%20simply%20hardcode%20a%20width%20of%204%20anymore%2C%20so%20we%20use%20the%20constant.%0A%20%20%20%20output%20%3C%3D%20std_logic_vector(to_unsigned(count_r%2C%20NUM_BITS))%3B%0A%20%20%20%20%0Aend%20BHV_INT%3B%0A%0A%0A--%20This%20architecture%20modifies%20the%20unsigned%20implementation%20of%20counter4bit%20to%0A--%20support%20a%20generic%20MAX_VALUE.%20Note%20that%20the%20previous%20advantages%20of%20unsigned%0A--%20do%20not%20apply%20here%20because%20MAX_VALUE%20does%20not%20have%20to%20be%20a%20power%20of%202%20-%201.%0A--%20In%20fact%2C%20in%20this%20case%20the%20integer%20and%20unsigned%20implementations%20are%20very%0A--%20similar.%0A%0Aarchitecture%20BHV_UNSIGNED%20of%20counter_max%20is%0A%0A%20%20%20%20--%20We%20have%20to%20recalculate%20the%20bits%20here%20again.%20It%20would%20definitely%20be%0A%20%20%20%20--%20best%20to%20use%20a%20function%20in%20a%20package.%20See%20the%20next%20entity.%0A%20%20%20%20constant%20NUM_BITS%20%3A%20positive%20%3A%3D%20integer(ceil(log2(real(MAX_VALUE%2B1))))%3B%0A%0A%20%20%20%20--%20when%20using%20the%20generic%20MAX_VALUE%2C%20count%20requires%20NUM_BITS%20bits.%0A%20%20%20%20signal%20count_r%20%3A%20unsigned(NUM_BITS-1%20downto%200)%3B%0A%20%20%20%20%0Abegin%0A%20%20%20%20process(clk%2C%20rst)%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20if%20(rst%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20We%20can&#39;t%20use%20a%20hardcoded%20literal%20anymore%20because%20the%20width%20can%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20change%20with%20MAX_VALUE.%20We%20also%20can&#39;t%20assign%20an%20integer%20to%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20a%20vector%20(without%20using%20conversion%20functions).%0A%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20(others%20%3D%3E%20&#39;0&#39;)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20elsif%20(rising_edge(clk))%20then%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20We%20can%20no%20longer%20simply%20add%2Fsubtract%201%20because%20MAX_VALUE%20may%20not%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20be%20a%20power%20of%202%20-%201%20(e.g.%2C%203%2C7%2C15%2Cetc.).%20Instead%2C%20we%20have%20to%20use%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20a%20similar%20strategy%20as%20the%20integer%20implementation.%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(up%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%20MAX_VALUE)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20to_unsigned(0%2C%20NUM_BITS)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20%2B%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%200)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20to_unsigned(MAX_VALUE%2C%20NUM_BITS)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20-%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20end%20process%3B%0A%0A%20%20%20%20output%20%3C%3D%20std_logic_vector(count_r)%3B%0A%20%20%20%20%0Aend%20BHV_UNSIGNED%3B%0A%0A%0A-------------------------------------------------------------------------%0A%0A--%20Greg%20Stitt%0A--%20University%20of%20Florida%0A%0A--%20This%20examples%20shows%20how%20to%20extend%20the%20previous%20counter%20entity%20with%20a%20custom%0A--%20package%20that%20includes%20a%20function%20for%20computing%20the%20number%20of%20bits%2C%20which%0A--%20makes%20the%20code%20much%20more%20concise.%20Make%20sure%20to%20also%20look%20at%20counter_pkg.vhd%0A%0Alibrary%20ieee%3B%0Ause%20ieee.std_logic_1164.all%3B%0Ause%20ieee.numeric_std.all%3B%0Ause%20ieee.math_real.all%3B%0A%0A--%20Include%20a%20custom%20package%20that%20defines%20a%20function%20for%20computing%20the%20number%20of%0A--%20bits%20in%20signal.%0Ause%20work.counter_pkg.all%3B%0A%0Aentity%20counter_max2%20is%0A%20%20%20%20generic(MAX_VALUE%20%3A%20positive%20%3A%3D%2015)%3B%0A%20%20%20%20port%20(%0A%20%20%20%20%20%20%20%20clk%20%3A%20in%20std_logic%3B%0A%20%20%20%20%20%20%20%20rst%20%3A%20in%20std_logic%3B%0A%20%20%20%20%20%20%20%20up%20%20%3A%20in%20std_logic%3B%0A%0A%0A%20%20%20%20%20%20%20%20--%20In%20this%20version%2C%20we%20replace%20the%20ugly%20computation%3A%0A%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20--%20integer(ceil(log2(real(MAX_VALUE%2B1))))%0A%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20--%20with%20a%20clog2%20function%20that%20we%20added%20to%20counter_pkg.%0A%0A%20%20%20%20%20%20%20%20output%20%3A%20out%20std_logic_vector(clog2(MAX_VALUE%2B1)-1%20downto%200))%3B%0Aend%20counter_max2%3B%0A%0A%0Aarchitecture%20BHV_INT%20of%20counter_max2%20is%0A%0A%20%20%20%20signal%20count_r%20%3A%20integer%20range%200%20to%20MAX_VALUE%3B%0A%20%20%20%20%0Abegin%0A%20%20%20%20%0A%20%20%20%20process(clk%2C%20rst)%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20if%20(rst%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%200%3B%0A%20%20%20%20%20%20%20%20elsif%20(rising_edge(clk))%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(up%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%20MAX_VALUE)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20%2B%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%200)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20MAX_VALUE%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20-%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20end%20process%3B%0A%0A%20%20%20%20--%20Since%20the%20previously%20used%20constant%20just%20represented%20the%20number%20of%20bits%0A%20%20%20%20--%20in%20the%20output%2C%20we%20can%20access%20the%20same%20information%20via%20the%20&#39;length%0A%20%20%20%20--%20attribute.%0A%20%20%20%20output%20%3C%3D%20std_logic_vector(to_unsigned(count_r%2C%20output&#39;length))%3B%0A%20%20%20%20%0Aend%20BHV_INT%3B%0A%0A%0Aarchitecture%20BHV_UNSIGNED%20of%20counter_max2%20is%0A%0A%20%20%20%20--%20We%20previously%20used%20the%20NUM_BITS%20constant%20to%20define%20the%20range%20of%20the%0A%20%20%20%20--%20count%2C%20but%20we%20can%20just%20use%20the%20output&#39;s%20range%20attribute%20and%20get%20rid%0A%20%20%20%20--%20of%20the%20constant.%0A%20%20%20%20signal%20count_r%20%3A%20unsigned(output&#39;range)%3B%0A%20%20%20%20%0Abegin%0A%20%20%20%20process(clk%2C%20rst)%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20if%20(rst%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20(others%20%3D%3E%20&#39;0&#39;)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20elsif%20(rising_edge(clk))%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(up%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%20MAX_VALUE)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20to_unsigned(0%2C%20count_r&#39;length)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20%2B%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%200)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20to_unsigned(MAX_VALUE%2C%20count_r&#39;length)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20-%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20end%20process%3B%0A%0A%20%20%20%20output%20%3C%3D%20std_logic_vector(count_r)%3B%0A%20%20%20%20%0Aend%20BHV_UNSIGNED%3B%0A%0A%0A%0A--------------------------------------------------------------------------%0A--%20Top-level%20entity%20for%20evaluating%20each%20of%20the%20different%20implementations.%0A%0Alibrary%20ieee%3B%0Ause%20ieee.std_logic_1164.all%3B%0Ause%20ieee.numeric_std.all%3B%0Ause%20ieee.math_real.all%3B%0Ause%20work.counter_pkg.all%3B%0A%0Aentity%20counter%20is%0A%20%20%20%20generic(MAX_VALUE%20%3A%20positive%20%3A%3D%2015)%3B%0A%20%20%20%20port%20(%0A%20%20%20%20%20%20%20%20clk%20%20%20%20%3A%20in%20%20std_logic%3B%0A%20%20%20%20%20%20%20%20rst%20%20%20%20%3A%20in%20%20std_logic%3B%0A%20%20%20%20%20%20%20%20up%20%20%20%20%20%3A%20in%20%20std_logic%3B%0A%20%20%20%20%20%20%20%20output%20%3A%20out%20std_logic_vector(clog2(MAX_VALUE%2B1)-1%20downto%200))%3B%0Aend%20counter%3B%0A%0Aarchitecture%20default_arch%20of%20counter%20is%0Abegin%0A%0A%20%20%20%20--%20INSTRUCTIONS%3A%20uncomment%20the%20implementation%20you%20want%20to%20evaluate.%20If%0A%20%20%20%20--%20testing%20counter4bit%2C%20make%20sure%20to%20commen%20out%20the%20generic%20map.%20Also%20make%0A%20%20%20%20--%20sure%20to%20set%20MAX_VALUE%20to%2015%20in%20the%20testbench.%0A%20%20%20%20%0A%20%20%20%20--U_COUNTER%20%3A%20entity%20work.counter4bit(BHV_INT_BAD1)%0A%20%20%20%20--U_COUNTER%20%3A%20entity%20work.counter4bit(BHV_INT_BAD2)%0A%20%20%20%20%20--U_COUNTER%20%3A%20entity%20work.counter4bit(BHV_INT_GOOD)%0A%20%20%20%20--U_COUNTER%20%3A%20entity%20work.counter4bit(BHV_UNSIGNED)%0A%20%20%20%20%20%20%20%20--U_COUNTER%20%3A%20entity%20work.counter_max(BHV_INT)%0A%20%20%20%20--U_COUNTER%20%3A%20entity%20work.counter_max(BHV_UNSIGNED)%0A%20%20%20%20--U_COUNTER%20%3A%20entity%20work.counter_max2(BHV_INT)%0A%20%20%20%20U_COUNTER%20%3A%20entity%20work.counter_max2(BHV_UNSIGNED)%0A%20%20%20%20%20%20%20%20generic%20map%20(MAX_VALUE%20%3D%3E%20MAX_VALUE)%0A%20%20%20%20%20%20%20%20port%20map%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20clk%20%20%20%20%3D%3E%20clk%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20rst%20%20%20%20%3D%3E%20rst%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20up%20%20%20%20%20%3D%3E%20up%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20output%20%3D%3E%20output)%3B%0A%0Aend%20default_arch%3B%0A%0A" style="text-decoration:none !important;" download="counter.vhd"><code style="border:1px solid var(--vp-c-brand-darker);color:var(--vp-c-brand-darker);padding:0.4em 0.8em;margin-right:0.8em;">counter.vhd</code></a><a href="data:text/plain;charset=utf-8,--%20Greg%20Stitt%0A--%20University%20of%20Florida%0A%0A--%20This%20file%20implements%20a%20new%20package%20for%20the%20counter%20that%20includes%20a%20function%0A--%20for%20more%20concisely%20computing%20the%20number%20of%20bits.%0A%0Alibrary%20ieee%3B%0Ause%20ieee.std_logic_1164.all%3B%0Ause%20ieee.numeric_std.all%3B%0Ause%20ieee.math_real.all%3B%0A%0Apackage%20counter_pkg%20is%0A%0A%20%20%20%20--%20Function%3A%20clog2()%0A%20%20%20%20--%20Description%3A%20Takes%20the%20ceil(log2)%20of%20a%20positive%20integer.%0A%20%20%20%20--%20Useful%20for%20avoiding%20all%20the%20casting%20that%20takes%20place%20in%20math_real.%0A%20%20%20%20function%20clog2(input%20%3A%20positive)%20return%20positive%3B%0A%0Aend%20package%3B%0A%0Apackage%20body%20counter_pkg%20is%0A%0A%20%20%20%20function%20clog2(input%20%3A%20positive)%20return%20positive%20is%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20return%20positive(ceil(log2(real(input))))%3B%0A%20%20%20%20end%20function%3B%0A%0Aend%20package%20body%3B%0A" style="text-decoration:none !important;" download="counter_pkg.vhd"><code style="border:1px solid var(--vp-c-brand-darker);color:var(--vp-c-brand-darker);padding:0.4em 0.8em;margin-right:0.8em;">counter_pkg.vhd</code></a><a href="data:text/plain;charset=utf-8,--%20Greg%20Stitt%0A--%20University%20of%20Florida%0A%0A--%20Basic%20testbench%20for%20the%20counter%20entities.%20Demonstrates%20how%20to%20simulate%0A--%20for%20a%20specific%20amount%20of%20time.%0A%0Alibrary%20ieee%3B%0Ause%20ieee.std_logic_1164.all%3B%0Ause%20ieee.numeric_std.all%3B%0Ause%20ieee.math_real.all%3B%0Ause%20work.counter_pkg.all%3B%0A%0Aentity%20counter_tb%20is%0Aend%20counter_tb%3B%0A%0A%0Aarchitecture%20TB%20of%20counter_tb%20is%0A%0A%20%20%20%20constant%20TOTAL_TIME%20%20%3A%20time%20%3A%3D%201%20ms%3B%0A%20%20%20%20constant%20TOGGLE_TIME%20%3A%20time%20%3A%3D%20500%20ns%3B%0A%0A%20%20%20%20--%20INSTRUCTIONS%3A%20Change%20this%20value%20to%20test%20different%20counters%2C%20but%20make%0A%20%20%20%20--%20sure%20to%20set%20to%2015%20if%20testing%20the%204-bit%20counter.%0A%20%20%20%20constant%20MAX_VALUE%20%3A%20integer%20%3A%3D%2015%3B%0A%20%20%20%20constant%20NUM_BITS%20%20%3A%20integer%20%3A%3D%20clog2(MAX_VALUE%2B1)%3B%0A%0A%20%20%20%20signal%20clk%20%20%20%20%3A%20std_logic%20%3A%3D%20&#39;0&#39;%3B%0A%20%20%20%20signal%20rst%20%20%20%20%3A%20std_logic%20%3A%3D%20&#39;0&#39;%3B%0A%20%20%20%20signal%20up%20%20%20%20%20%3A%20std_logic%20%3A%3D%20&#39;1&#39;%3B%0A%20%20%20%20signal%20up_val%20%3A%20std_logic%20%3A%3D%20&#39;1&#39;%3B%0A%20%20%20%20signal%20output%20%3A%20std_logic_vector(NUM_BITS-1%20downto%200)%3B%0A%0A%20%20%20%20signal%20done%20%20%20%3A%20std_logic%20%3A%3D%20&#39;0&#39;%3B%0A%20%20%20%20signal%20clk_en%20%3A%20std_logic%20%3A%3D%20&#39;1&#39;%3B%0A%0A%20%20%20%20signal%20overflow%20%20%3A%20boolean%20%3A%3D%20false%3B%0A%20%20%20%20signal%20underflow%20%3A%20boolean%20%3A%3D%20false%3B%0A%0A%20%20%20%20--%20Reference%20model%20signals.%0A%20%20%20%20signal%20count_r%20%20%20%20%20%20%20%20%3A%20unsigned(output&#39;range)%3B%0A%20%20%20%20signal%20output_correct%20%3A%20std_logic_vector(NUM_BITS-1%20downto%200)%3B%0A%20%20%20%20%0Abegin%0A%0A%20%20%20%20--%20Change%20the%20architecture%20to%20test%20the%20different%20implementations%20and%0A%20%20%20%20--%20different%20max_values%0A%20%20%20%20DUT%20%3A%20entity%20work.counter%0A%20%20%20%20%20%20%20%20generic%20map%20(MAX_VALUE%20%3D%3E%20MAX_VALUE)%0A%20%20%20%20%20%20%20%20port%20map%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20clk%20%20%20%20%3D%3E%20clk%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20rst%20%20%20%20%3D%3E%20rst%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20up%20%20%20%20%20%3D%3E%20up%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20output%20%3D%3E%20output)%3B%0A%0A%20%20%20%20clk%20%3C%3D%20not%20clk%20and%20clk_en%20after%2010%20ns%3B%0A%0A%20%20%20%20--%20Toggle%20the%20more%20likely%20value%20of%20up%20every%20TOGGLE_TIME%0A%20%20%20%20up_val%20%3C%3D%20not%20up_val%20and%20not%20done%20after%20TOGGLE_TIME%3B%0A%0A%20%20%20%20--%20stop%20the%20simulation%20after%205000%20ns%3B%0A%20%20%20%20done%20%3C%3D%20&#39;1&#39;%20after%20TOTAL_TIME%3B%0A%0A%20%20%20%20process%0A%20%20%20%20%20%20%20%20variable%20seed1%2C%20seed2%20%3A%20positive%20%3A%3D%201%3B%0A%20%20%20%20%20%20%20%20variable%20rand_val%20%20%20%20%20%3A%20real%3B%0A%0A%20%20%20%20%20%20%20%20variable%20up_temp%20%3A%20std_logic%3B%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20--%20Reset%20the%20counter%20for%204%20cycles.%0A%20%20%20%20%20%20%20%20rst%20%3C%3D%20&#39;1&#39;%3B%0A%20%20%20%20%20%20%20%20for%20i%20in%200%20to%203%20loop%0A%20%20%20%20%20%20%20%20%20%20%20%20wait%20until%20rising_edge(clk)%3B%0A%20%20%20%20%20%20%20%20end%20loop%3B%0A%0A%20%20%20%20%20%20%20%20--%20Clear%20reset.%0A%20%20%20%20%20%20%20%20rst%20%3C%3D%20&#39;0&#39;%3B%0A%20%20%20%20%20%20%20%20wait%20until%20rising_edge(clk)%3B%0A%0A%20%20%20%20%20%20%20%20while%20(done%20%3D%20&#39;0&#39;)%20loop%0A%20%20%20%20%20%20%20%20%20%20%20%20uniform(seed1%2C%20seed2%2C%20rand_val)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(rand_val%20%3E%200.75)%20then%20up_temp%20%3A%3D%20up_val%3B%20else%20up_temp%20%3A%3D%20not%20up_val%3B%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20up%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%3D%20up_temp%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20--%20Check%20to%20see%20if%20overflow%20or%20underflow%20was%20tested.%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(unsigned(output)%20%3D%20MAX_VALUE%20and%20up_temp%20%3D%20&#39;1&#39;)%20then%20overflow%20%20%20%20%3C%3D%20true%3B%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(output%20%3D%20(output&#39;range%20%3D%3E%20&#39;0&#39;)%20and%20up_temp%20%3D%20&#39;0&#39;)%20then%20underflow%20%3C%3D%20true%3B%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20wait%20until%20rising_edge(clk)%3B%0A%0A%20%20%20%20%20%20%20%20end%20loop%3B%0A%0A%20%20%20%20%20%20%20%20clk_en%20%3C%3D%20&#39;0&#39;%3B%0A%0A%20%20%20%20%20%20%20%20--%20Print%20warnings%20if%20overflow%20and%20underflow%20were%20tested.%0A%20%20%20%20%20%20%20%20--%0A%20%20%20%20%20%20%20%20--%20SYSTEMVERILOG%20COMPARISON%3A%20SystemVerilog%20has%20a%20cover%20property%0A%20%20%20%20%20%20%20%20--%20construct%2C%20which%20is%20a%20much%20more%20concise%20way%20of%20determining%20whether%0A%20%20%20%20%20%20%20%20--%20or%20not%20various%20events%20occurred%20during%20a%20simulation.%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20assert(overflow)%20report%20%22WARNING%3A%20Overflow%20never%20tested.%22%3B%0A%20%20%20%20%20%20%20%20assert(underflow)%20report%20%22WARNING%3A%20Underflow%20never%20tested.%22%3B%0A%20%20%20%20%20%20%20%20report%20%22Tests%20completed.%22%3B%0A%20%20%20%20%20%20%20%20wait%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20end%20process%3B%0A%0A%20%20%20%20assert(not%20(rising_edge(clk)%20and%20output%20%2F%3D%20output_correct))%3B%0A%0A%20%20%20%20---------------------------------------------------------------------%0A%20%20%20%20--%20Reference%20model.%0A%0A%20%20%20%20--%20It%20is%20a%20bad%20idea%20to%20reuse%20one%20of%20the%20implementations%20as%20the%20reference%0A%20%20%20%20--%20model%2C%20unless%20that%20model%20has%20already%20been%20verified.%20It%20is%20reused%20here%0A%20%20%20%20--%20to%20avoid%20creating%20having%20to%20create%20another%20counter.%0A%0A%20%20%20%20process(clk%2C%20rst)%0A%20%20%20%20begin%0A%20%20%20%20%20%20%20%20if%20(rst%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20(others%20%3D%3E%20&#39;0&#39;)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20elsif%20(rising_edge(clk))%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(up%20%3D%20&#39;1&#39;)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%20MAX_VALUE)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20to_unsigned(0%2C%20count_r&#39;length)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20%2B%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(count_r%20%3D%200)%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20to_unsigned(MAX_VALUE%2C%20count_r&#39;length)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20count_r%20%3C%3D%20count_r%20-%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20%20%20%20%20end%20if%3B%0A%20%20%20%20end%20process%3B%0A%0A%20%20%20%20output_correct%20%3C%3D%20std_logic_vector(count_r)%3B%0A%20%20%20%20%0Aend%20TB%3B%0A" style="text-decoration:none !important;" download="counter_tb.vhd"><code style="border:1px solid var(--vp-c-brand-darker);color:var(--vp-c-brand-darker);padding:0.4em 0.8em;margin-right:0.8em;">counter_tb.vhd</code></a></div><div style="font-size:0.8em;font-weight:bold;margin-top:1em;"> If your browser displays the code as plain text, press <code style="font-size:inherit;">Ctrl/Cmd</code> + <code style="font-size:inherit;">S</code> to save it. </div></details><h2 id="brief" tabindex="-1">Brief <a class="header-anchor" href="#brief" aria-hidden="true">#</a></h2><ul><li><p>Demonstrates various way of creating counters.</p></li><li><p>Illustrates differences between integer and unsigned/signed types.</p></li><li><p>Explains how to create functions in packages so they can be used in ports.</p></li><li><p>Demonstrates usage of signal attributes to replace constants and ranges.</p></li><li><p>Testbench demonstrates how to simulate for a specific amount of time, and how to verify that various events were tested.</p></li></ul><h2 id="entity-counter4bit" tabindex="-1">ENTITY <code> counter4bit</code> <a class="header-anchor" href="#entity-counter4bit" aria-hidden="true">#</a></h2><p>Greg Stitt University of Florida</p><p>The examples shows a variety of ways of creating counters, while also illustrating the differences between integer and vector types. The examples also show how to define custom functions and use attributes to simplify the code.</p><p>TAKEAWAY POINTS: My recommendation is to only use integer types for constants or literals. If you do use them for signals/variables, then the range should be constrained. Even then, constrained integers frequently cause simulation errors.</p><p>The following counter entity shows another basic sequential logic example, but compares the usage of the integer type and unsigned type. For this particular example, unsigned is clearly the better choice.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">entity</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter4bit</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">port</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        clk    </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        rst    </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        up     </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">out</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">downto</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter4bit</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="arch-bhv-int-bad1-of-counter4bit" tabindex="-1">ARCH <code> BHV_INT_BAD1</code> of <code>counter4bit</code> <a class="header-anchor" href="#arch-bhv-int-bad1-of-counter4bit" aria-hidden="true">#</a></h2><p>The first architecture illustrates a common problem with the integer type.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">architecture</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_INT_BAD1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter4bit</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Use an internal signal to maintain the count. The counter is 4 bits so</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- we want the range to be from 0 to 15.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- IMPORTANT: When using an integer type, you should always constrain the</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- range of possible values. If you don&#39;t, it will synthesize to 32 bits,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- which is likely a signficant waste of space. In some cases, synthesis</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- will be able to optimize away the extra bits, but it is better to</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- always explicitly constrain it.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">integer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">range</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- A counter involves sequential logic, so follow the guidelines for</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- sequential logic.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">process(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rst </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- Initialize the count. Integer literals do not use quotes.</span></span>
<span class="line"><span style="color:#A6ACCD;">            count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">elsif</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- Implement the basic counter functionality.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- Although this looks like it should work, if you simulate this</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- code, you will receive an error similar to the following:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- Fatal: (vsim-3421) Value 16 for count is out of range 0 to 15.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- The problem occurs because the integer type will not rollover</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- from its maximum value (15) to its minimum value (0) when there</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- is overflow. Instead, when the simulation adds 1 to count when</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- count = 15, count will become 16. However, we defined count as</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- only having values from 0 to 15, so 16 is invalid, which causes</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- the simulation error. The same problem would occur when</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- subtracting 1 when count = 0.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- This problem demonstrates one of the main annoyances of the</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- integer type. You have to be 100% sure that the signal will</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- never have a value outside of the specified range.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- I almost never use integers for this reason. What makes this</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- especially problematic is that this code will likely synthesize</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- with the correct functionality, but you can&#39;t simulate it, so</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- it isn&#39;t very useful.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">process;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Send the count to the output. Notice that this is done outside of the</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- process, otherwise there would be an additional register for output,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- which we don&#39;t want. To convert from integer to std_logic_vector, you</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- can first convert to unsigned using the to_unsigned function, assuming</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- you are using numeric_std.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_INT_BAD1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="arch-bhv-int-bad2-of-counter4bit" tabindex="-1">ARCH <code> BHV_INT_BAD2</code> of <code>counter4bit</code> <a class="header-anchor" href="#arch-bhv-int-bad2-of-counter4bit" aria-hidden="true">#</a></h2><p>The following architecture demonstrates another common mistake when using integers.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">architecture</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_INT_BAD2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter4bit</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">integer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">range</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">process(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- To avoid the problem with the previous architecture, we are going to</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- add values using a variable, check the variable for overflow, and</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- then update the count.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">variable</span><span style="color:#A6ACCD;"> temp </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">integer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">range</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rst </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">elsif</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- Get the new count</span></span>
<span class="line"><span style="color:#A6ACCD;">                temp </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- Check to see if we exceeded the maximum value</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">temp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> temp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">else</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- Get the new count</span></span>
<span class="line"><span style="color:#A6ACCD;">                temp </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- Check to see if we exceeded the minimum value</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">temp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> temp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- When simulting this code, we get a similar error:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- Fatal: (vsim-3421) Value 16 for temp is out of range 0 to 15.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- This error occurs for a similar reason as before. When we add</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- one to count when count = 15, temp needs to be able to store 16.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- Likewise, when we subtract one from count when it is 0, temp</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- needs to store -1. However, we declared temp as having a range</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- from 0 to 15.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- We could potentially fix the problem by changing the range of</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- temp from -1 to 16, but the following architectures shows a more</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- concise solution.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- The key point to remember is that when using an integer, you</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- have to be sure that the signal/variable will never exceed that</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- range. Although it might be obvious for this simple counter, for</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- complex examples using integers, it can be very difficult.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">process;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_INT_BAD2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="arch-bhv-int-good-of-counter4bit" tabindex="-1">ARCH <code> BHV_INT_GOOD</code> of <code>counter4bit</code> <a class="header-anchor" href="#arch-bhv-int-good-of-counter4bit" aria-hidden="true">#</a></h2><p>The following architecture show a correct implementation of the counter when using integers</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">architecture</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_INT_GOOD</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter4bit</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">integer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">range</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">process(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rst </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">elsif</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- Instead of using a variable to check for overflow, we can</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- simply check to see if count is already at the max value. If</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- so, set it to 0 instead of adding 1.</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- Similarly, if we are counting down and count = 0, set the</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- count to 15 insted of subtracting 1.</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">process;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_INT_GOOD</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="arch-bhv-unsigned-of-counter4bit" tabindex="-1">ARCH <code> BHV_UNSIGNED</code> of <code>counter4bit</code> <a class="header-anchor" href="#arch-bhv-unsigned-of-counter4bit" aria-hidden="true">#</a></h2><p>Although the previous architecture works, we had to use additional code to make sure that count values wrapped around appropriately. If we use unsigned, signed, or std_logic_vector, the wrapping around is handled automatically by the type.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">architecture</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_UNSIGNED</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter4bit</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Use a 4 bit unsigned instead of an integer.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">downto</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">process(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rst </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&quot;0000&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">elsif</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- Here that we can just add or subtract 1 without any range</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- check because wrapping will automatically occur.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- Notice that we can actually add an unsigned/signed with an</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- integer because numeric_std also defines most operators for</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- integer types. Fortunately, you do not have to worry about</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- about the 32-bit integer increasing the size of the circuit.</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- When adding an unsigned/signed with an integer, the integer</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- is automatically truncated to the width of the</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">-- unsigned/signed. </span></span>
<span class="line"><span style="color:#A6ACCD;">                count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">process;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_UNSIGNED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="entity-counter-max" tabindex="-1">ENTITY <code> counter_max</code> <a class="header-anchor" href="#entity-counter-max" aria-hidden="true">#</a></h2><p>The following counter extends the previous counter4bit entity with a generic that specifies the maximum counter value. The minimum value is assumed to be 0. As an exercise, I would recommend adding a MIN_VALUE that supports negative numbers and changing the counter to signed.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">entity</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_max</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">generic(</span><span style="color:#A6ACCD;">MAX_VALUE </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">positive</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">port</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        clk </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        rst </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        up  </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- For this entity, the output is not a fixed number of bits. </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- The output has MAX_VALUE+1 possible values, so we need to do some</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- math to calculate the number of bits. If MAX_VALUE+1 was a power</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- of 2, we could just do log2(MAX_VALUE+1).</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- However, MAX_VALUE is a generic and can be any possible value.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- We therefore want to take the ceiling of the log2 to ensure we</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- have enough bits.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- e.g., if the maximum value is 10, the output can have 11 possible</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- values. log2(11) = 3.4, which will round down to 3 when used as an</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- integer. However, we know we need 4 bits since 3 bits only supports</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- 8 values, with a maximum value of 7. By taking the ceiling,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- ceil(3.4) = 4, we get the correct number of bits.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- To do this calculation in VHDL, we can use the log2 and ceil function</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- from the math_real package. However, log2 and ceil only support the</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- real type, so we have to cast the input to real. Similarly, we need</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- to cast the ceil result back to an integer. The complete, horribly</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- ugly computation is: integer(ceil(log2(real(MAX_VALUE+1)))). I will</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- show a more readable way of doing this in the next entity.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- Be aware that calculating the appropriate number of bits is a</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- common place for errors. You should test this for a large number</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- of generics to be confident that it is correct. A very common</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- mistake is forgetting the +1. Remember that log2 of a number doesn&#39;t</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- tell you the number of bits needed to represent that number, unless</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- it is a power of 2. Log2(n) specifies how many bits are required to</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- represent n different values. Since we also have to support 0, there</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- are n+1 total values.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">out</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">integer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">ceil</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">log2</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">real</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">))))-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">downto</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_max</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="arch-bhv-int-of-counter-max" tabindex="-1">ARCH <code> BHV_INT</code> of <code>counter_max</code> <a class="header-anchor" href="#arch-bhv-int-of-counter-max" aria-hidden="true">#</a></h2><p>In this architecture, we modify the integer implementation from the counter4bit entity by replacing the hardcoded 15 with MAX_VALUE.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">architecture</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_INT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_max</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">integer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">range</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">to</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- We need the number of bits later, so create a constant.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- If you are wondering if we could use a constant when defining</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- the width of output in the port statement, the answer is sometimes.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- You can define constants in a custom package and then use those</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- constants in port definitions. However, VHDL pre-2008 doesn&#39;t allow you</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- to define constants in packages based on generic values. So, for this</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- entity, we are stuck with using the bit calculation in the port</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- definition. We could also create a function that returns the number of</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- bits, which could be used everywhere, but that will be shown in a later</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- example.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">constant</span><span style="color:#A6ACCD;"> NUM_BITS </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">positive</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">integer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">ceil</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">log2</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">real</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">))));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">process(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rst </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">elsif</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">process;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- We can&#39;t simply hardcode a width of 4 anymore, so we use the constant.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> NUM_BITS</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_INT</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="arch-bhv-unsigned-of-counter-max" tabindex="-1">ARCH <code> BHV_UNSIGNED</code> of <code>counter_max</code> <a class="header-anchor" href="#arch-bhv-unsigned-of-counter-max" aria-hidden="true">#</a></h2><p>This architecture modifies the unsigned implementation of counter4bit to support a generic MAX_VALUE. Note that the previous advantages of unsigned do not apply here because MAX_VALUE does not have to be a power of 2 - 1. In fact, in this case the integer and unsigned implementations are very similar.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">architecture</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_UNSIGNED</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_max</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- We have to recalculate the bits here again. It would definitely be</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- best to use a function in a package. See the next entity.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">constant</span><span style="color:#A6ACCD;"> NUM_BITS </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">positive</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">integer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">ceil</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">log2</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">real</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">))));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- when using the generic MAX_VALUE, count requires NUM_BITS bits.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">NUM_BITS</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">downto</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">process(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rst </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- We can&#39;t use a hardcoded literal anymore because the width can</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- change with MAX_VALUE. We also can&#39;t assign an integer to</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- a vector (without using conversion functions).</span></span>
<span class="line"><span style="color:#A6ACCD;">            count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(others</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">elsif</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- We can no longer simply add/subtract 1 because MAX_VALUE may not</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- be a power of 2 - 1 (e.g., 3,7,15,etc.). Instead, we have to use</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- a similar strategy as the integer implementation.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> NUM_BITS</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> NUM_BITS</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">process;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_UNSIGNED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="entity-counter-max2" tabindex="-1">ENTITY <code> counter_max2</code> <a class="header-anchor" href="#entity-counter-max2" aria-hidden="true">#</a></h2><p>Greg Stitt University of Florida</p><p>This examples shows how to extend the previous counter entity with a custom package that includes a function for computing the number of bits, which makes the code much more concise. Make sure to also look at counter_pkg.vhd</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">library</span><span style="color:#A6ACCD;"> ieee</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">use</span><span style="color:#A6ACCD;"> ieee</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">std_logic_1164</span><span style="color:#89DDFF;">.all;</span></span>
<span class="line"><span style="color:#89DDFF;">use</span><span style="color:#A6ACCD;"> ieee</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">numeric_std</span><span style="color:#89DDFF;">.all;</span></span>
<span class="line"><span style="color:#89DDFF;">use</span><span style="color:#A6ACCD;"> ieee</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">math_real</span><span style="color:#89DDFF;">.all;</span></span>
<span class="line"></span></code></pre></div><p>Include a custom package that defines a function for computing the number of bits in signal.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">entity</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_max2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">generic(</span><span style="color:#A6ACCD;">MAX_VALUE </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">positive</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">port</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        clk </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        rst </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        up  </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- In this version, we replace the ugly computation:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- integer(ceil(log2(real(MAX_VALUE+1))))</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- with a clog2 function that we added to counter_pkg.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">out</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clog2</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">downto</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_max2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="arch-bhv-int-of-counter-max2" tabindex="-1">ARCH <code> BHV_INT</code> of <code>counter_max2</code> <a class="header-anchor" href="#arch-bhv-int-of-counter-max2" aria-hidden="true">#</a></h2><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">architecture</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_INT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_max2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">integer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">range</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">to</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">process(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rst </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">elsif</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">process;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Since the previously used constant just represented the number of bits</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- in the output, we can access the same information via the &#39;length</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- attribute.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">&#39;length));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_INT</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="arch-bhv-unsigned-of-counter-max2" tabindex="-1">ARCH <code> BHV_UNSIGNED</code> of <code>counter_max2</code> <a class="header-anchor" href="#arch-bhv-unsigned-of-counter-max2" aria-hidden="true">#</a></h2><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">architecture</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_UNSIGNED</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_max2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- We previously used the NUM_BITS constant to define the range of the</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- count, but we can just use the output&#39;s range attribute and get rid</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- of the constant.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">&#39;range);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">process(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rst </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(others</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">elsif</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> count_r</span><span style="color:#89DDFF;">&#39;length);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> count_r</span><span style="color:#89DDFF;">&#39;length);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">process;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BHV_UNSIGNED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="entity-counter" tabindex="-1">ENTITY <code> counter</code> <a class="header-anchor" href="#entity-counter" aria-hidden="true">#</a></h2><p>Top-level entity for evaluating each of the different implementations.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">entity</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">generic(</span><span style="color:#A6ACCD;">MAX_VALUE </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">positive</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">port</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        clk    </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        rst    </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        up     </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">out</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clog2</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">downto</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="arch-default-arch-of-counter" tabindex="-1">ARCH <code> default_arch</code> of <code>counter</code> <a class="header-anchor" href="#arch-default-arch-of-counter" aria-hidden="true">#</a></h2><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">architecture</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">default_arch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"><span style="color:#89DDFF;">begin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- INSTRUCTIONS: uncomment the implementation you want to evaluate. If</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- testing counter4bit, make sure to commen out the generic map. Also make</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- sure to set MAX_VALUE to 15 in the testbench.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">--U_COUNTER : entity work.counter4bit(BHV_INT_BAD1)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">--U_COUNTER : entity work.counter4bit(BHV_INT_BAD2)</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;">--U_COUNTER : entity work.counter4bit(BHV_INT_GOOD)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">--U_COUNTER : entity work.counter4bit(BHV_UNSIGNED)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">--U_COUNTER : entity work.counter_max(BHV_INT)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">--U_COUNTER : entity work.counter_max(BHV_UNSIGNED)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">--U_COUNTER : entity work.counter_max2(BHV_INT)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">U_COUNTER</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">entity</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">work</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">counter_max2</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">BHV_UNSIGNED</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">generic</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">map</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">port</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">map</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">            clk    </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> clk</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            rst    </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            up     </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> up</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">default_arch</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="pkg-counter-pkg" tabindex="-1">PKG <code> counter_pkg</code> <a class="header-anchor" href="#pkg-counter-pkg" aria-hidden="true">#</a></h2><p>Greg Stitt University of Florida</p><p>This file implements a new package for the counter that includes a function for more concisely computing the number of bits.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_pkg</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Function: clog2()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Description: Takes the ceil(log2) of a positive integer.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Useful for avoiding all the casting that takes place in math_real.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">clog2</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">input</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">positive</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">positive</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">package;</span></span>
<span class="line"></span></code></pre></div><h2 id="pkg-body-counter-pkg" tabindex="-1">PKG <code> body counter_pkg</code> <a class="header-anchor" href="#pkg-body-counter-pkg" aria-hidden="true">#</a></h2><h2 id="entity-counter-tb" tabindex="-1">ENTITY <code> counter_tb</code> <a class="header-anchor" href="#entity-counter-tb" aria-hidden="true">#</a></h2><p>Greg Stitt University of Florida</p><p>Basic testbench for the counter entities. Demonstrates how to simulate for a specific amount of time.</p><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">entity</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_tb</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_tb</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="arch-tb-of-counter-tb" tabindex="-1">ARCH <code> TB</code> of <code>counter_tb</code> <a class="header-anchor" href="#arch-tb-of-counter-tb" aria-hidden="true">#</a></h2><div class="language-vhdl"><button class="copy"></button><span class="lang">vhdl</span><pre><code><span class="line"><span style="color:#89DDFF;">architecture</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">counter_tb</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">is</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">constant</span><span style="color:#A6ACCD;"> TOTAL_TIME  </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">time</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ms</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">constant</span><span style="color:#A6ACCD;"> TOGGLE_TIME </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">time</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">500</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ns</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- INSTRUCTIONS: Change this value to test different counters, but make</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- sure to set to 15 if testing the 4-bit counter.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">constant</span><span style="color:#A6ACCD;"> MAX_VALUE </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">integer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">constant</span><span style="color:#A6ACCD;"> NUM_BITS  </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">integer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> clog2</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> clk    </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> rst    </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> up     </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> up_val </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">NUM_BITS</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">downto</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> done   </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> clk_en </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> overflow  </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> underflow </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Reference model signals.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> count_r        </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">&#39;range);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">signal</span><span style="color:#A6ACCD;"> output_correct </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">NUM_BITS</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">downto</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">begin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Change the architecture to test the different implementations and</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- different max_values</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">DUT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">entity</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">work</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">counter</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">generic</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">map</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">port</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">map</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">            clk    </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> clk</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            rst    </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            up     </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> up</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    clk </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> clk </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> clk_en </span><span style="color:#89DDFF;">after</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ns</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Toggle the more likely value of up every TOGGLE_TIME</span></span>
<span class="line"><span style="color:#A6ACCD;">    up_val </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> up_val </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> done </span><span style="color:#89DDFF;">after</span><span style="color:#A6ACCD;"> TOGGLE_TIME</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- stop the simulation after 5000 ns;</span></span>
<span class="line"><span style="color:#A6ACCD;">    done </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">after</span><span style="color:#A6ACCD;"> TOTAL_TIME</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">process</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">variable</span><span style="color:#A6ACCD;"> seed1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> seed2 </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">positive</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">variable</span><span style="color:#A6ACCD;"> rand_val     </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">real</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">variable</span><span style="color:#A6ACCD;"> up_temp </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- Reset the counter for 4 cycles.</span></span>
<span class="line"><span style="color:#A6ACCD;">        rst </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">loop</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">wait</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">until</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">loop;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- Clear reset.</span></span>
<span class="line"><span style="color:#A6ACCD;">        rst </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">wait</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">until</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">done </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">loop</span></span>
<span class="line"><span style="color:#A6ACCD;">            uniform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">seed1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> seed2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rand_val</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rand_val </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.75</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span><span style="color:#A6ACCD;"> up_temp </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> up_val</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> up_temp </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> up_val</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            up                                </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> up_temp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">-- Check to see if overflow or underflow was tested.</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> MAX_VALUE </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> up_temp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span><span style="color:#A6ACCD;"> overflow    </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> true</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">&#39;range</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> up_temp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span><span style="color:#A6ACCD;"> underflow </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> true</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">wait</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">until</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">loop;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        clk_en </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- Print warnings if overflow and underflow were tested.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">--</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- SYSTEMVERILOG COMPARISON: SystemVerilog has a cover property</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- construct, which is a much more concise way of determining whether</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">-- or not various events occurred during a simulation.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">assert(</span><span style="color:#A6ACCD;">overflow</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">report</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;WARNING: Overflow never tested.&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">assert(</span><span style="color:#A6ACCD;">underflow</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">report</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;WARNING: Underflow never tested.&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">report</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;Tests completed.&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">wait;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">process;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">assert(not</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">output</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/=</span><span style="color:#A6ACCD;"> output_correct</span><span style="color:#89DDFF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">---------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- Reference model.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- It is a bad idea to reuse one of the implementations as the reference</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- model, unless that model has already been verified. It is reused here</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">-- to avoid creating having to create another counter.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">process(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rst</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">begin</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rst </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(others</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;0&#39;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">elsif</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rising_edge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">clk</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">up </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">&#39;1&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> MAX_VALUE</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> count_r</span><span style="color:#89DDFF;">&#39;length);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_unsigned</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MAX_VALUE</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> count_r</span><span style="color:#89DDFF;">&#39;length);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count_r </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> count_r </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">process;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    output_correct </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">std_logic_vector</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count_r</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TB</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div>`,57),e=[p];function t(c,r,A,D,C,y){return a(),n("div",null,e)}const u=s(o,[["render",t]]);export{F as __pageData,u as default};
